apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
namespace: ns-sourcegraph
resources:
  - ../../../base/monitoring
  - ../../../base/sourcegraph

replicas:
  - name: gitserver
    count: 5
  - name: sourcegraph-frontend
    count: 2

replacements:
  # IMPORTANT: This file is required when changing replica numbers for gitserver
  - path: sourcegraph-replicas.yaml

# INLINE OPTION:
# replacements:
# - source:
#     kind: StatefulSet
#     name: gitserver
#     fieldPath: spec.replicas
#   targets:
#   - select:
#       kind: Deployment
#       name: sourcegraph-frontend
#     fieldPaths:
#     - spec.template.spec.containers.[args=serve].env.[name=GITSERVER_REPLICAS_NUMBER].value
