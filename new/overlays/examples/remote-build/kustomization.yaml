# [EXAMPLE] An example overlay file using remote build
apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
namespace: sourcegraph-kustomize-example
resources:
  - https://github.com/sourcegraph/deploy-sourcegraph/new/base/sourcegraph?ref=v4.3.0                       # Sourcegraph Main Stacks
  - https://github.com/sourcegraph/deploy-sourcegraph/new/base/monitoring?ref=v4.3.0                        # Sourcegraph Monitoring Stacks - RBACs required

# Add components here
components:
  - https://github.com/sourcegraph/deploy-sourcegraph/new/kustomize/components/StorageClass/aws?ref=v4.3.0  # Create a StorageClass resource for aws
  # - ../../../components/StorageClass/aws                                                                  # You can also add local components for remote build

# Update env listed in frontend to use external database
patchesStrategicMerge:
# ACTION REQUIRED: Update the new values in this file
- frontend-env.yaml

# Update replica number here
replicas:
  - name: sourcegraph-frontend
    count: 3
  - name: searcher
    count: 2
  - name: symbols
    count: 2
  # IMPORTANT: You must add the 'sourcegraph-replicas.yaml' file under the 'replacements' field when updating gitserver replica number 
  - name: gitserver
    count: 5

replacements:
  # IMPORTANT: Must be included when changing replica numbers for gitserver, searcher, symbols and indexer
  - path: sourcegraph-replicas.yaml     # IMPORTANT: No changes required for this file
