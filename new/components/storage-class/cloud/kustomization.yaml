apiVersion: kustomize.config.k8s.io/v1alpha1
kind: Component
resources:
  - patches/sourcegraph.StorageClass.yaml
configMapGenerator:
  - name: sourcegraph-frontend-env
    behavior: merge
    literals:
      - DEPLOY_SOURCEGRAPH_STORAGECLASS_NAME=SOURCEGRAPH_OVERLAY_PLACEHOLDER
      - DEPLOY_SOURCEGRAPH_STORAGECLASS_PROVISIONER=SOURCEGRAPH_OVERLAY_PLACEHOLDER
      - DEPLOY_SOURCEGRAPH_STORAGECLASS_PARAM_TYPE=SOURCEGRAPH_OVERLAY_PLACEHOLDER
patchesJson6902:
  - target:
      kind: StatefulSet
      name: .*
      group: apps
      version: v1
    patch: |-
      - op: replace
        path: /spec/volumeClaimTemplates/0/spec/storageClassName
        value: sourcegraph
  - target:
      kind: PersistentVolumeClaim
      name: .*
      version: v1
    patch: |-
      - op: replace
        path: /spec/storageClassName
        value: sourcegraph
  - target:
      kind: StatefulSet
      name: .*
      group: apps
      version: v1
    path: patches/replace-storageclass-name-sts.yaml
  - target:
      kind: PersistentVolumeClaim
      name: .*
      version: v1
    path: patches/replace-storageclass-name-pvc.yaml
configurations:
- patches/storageclass-transformer.yaml
vars:
  - name: DEPLOY_SOURCEGRAPH_STORAGECLASS_NAME
    objref:
      apiVersion: v1
      kind: ConfigMap
      name: sourcegraph-frontend-env
    fieldref:
      fieldpath: data.DEPLOY_SOURCEGRAPH_STORAGECLASS_NAME
  - name: DEPLOY_SOURCEGRAPH_STORAGECLASS_PROVISIONER
    objref:
      apiVersion: v1
      kind: ConfigMap
      name: sourcegraph-frontend-env
    fieldref:
      fieldpath: data.DEPLOY_SOURCEGRAPH_STORAGECLASS_PROVISIONER
  - name: DEPLOY_SOURCEGRAPH_STORAGECLASS_PARAM_TYPE
    objref:
      apiVersion: v1
      kind: ConfigMap
      name: sourcegraph-frontend-env
    fieldref:
      fieldpath: data.DEPLOY_SOURCEGRAPH_STORAGECLASS_PARAM_TYPE
