apiVersion: apps/v1
kind: Deployment
metadata:
  name: blobstore
spec:
  template:
    spec:
      containers:
      - name: blobstore
        resources:
          limits:
            cpu: "2"
            memory: 2Gi
          requests:
            cpu: 100m
            memory: 250M
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: codeinsights-db
spec:
  template:
    spec:
      containers:
      - name: codeinsights
        resources:
          limits:
            cpu: "4"
            memory: 2Gi
          requests:
            cpu: 100m
            memory: 250M
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: codeintel-db
spec:
  template:
    spec:
      containers:
      - name: pgsql
        resources:
          limits:
            cpu: "4"
            memory: 4Gi
          requests:
            cpu: 100m
            memory: 250M
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: github-proxy
spec:
  template:
    spec:
      containers:
      - name: github-proxy
        resources:
          limits:
            cpu: "1"
            memory: 1G
          requests:
            cpu: 100m
            memory: 250M
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: pgsql
spec:
  template:
    spec:
      containers:
      - name: pgsql
        resources:
          limits:
            cpu: "8"
            memory: 32Gi
          requests:
            cpu: 100m
            memory: 250M
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: precise-code-intel-worker
spec:
  replicas: 1
  template:
    spec:
      containers:
      - name: precise-code-intel-worker
        resources:
          limits:
            cpu: "2"
            memory: 50G
          requests:
            cpu: 100m
            memory: 250M
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: redis-cache
spec:
  template:
    spec:
      containers:
      - name: redis-cache
        resources:
          limits:
            cpu: "1"
            memory: 5Gi
          requests:
            cpu: 100m
            memory: 250M
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: redis-store
spec:
  template:
    spec:
      containers:
      - name: redis-store
        resources:
          limits:
            cpu: "1"
            memory: 8Gi
          requests:
            cpu: 100m
            memory: 250M
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: repo-updater
spec:
  template:
    spec:
      containers:
      - name: repo-updater
        resources:
          limits:
            cpu: "4"
            memory: 4Gi
          requests:
            cpu: 100m
            memory: 250M
---
apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: searcher
spec:
  replicas: 2
  template:
    spec:
      containers:
      - name: searcher
        resources:
          limits:
            cpu: "10"
            memory: 16G
          requests:
            cpu: 100m
            memory: 250M
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: sourcegraph-frontend
spec:
  replicas: 2
  template:
    spec:
      containers:
      - name: frontend
        resources:
          limits:
            cpu: "9"
            memory: 24G
            ephemeral-storage: 12Gi
          requests:
            cpu: 100m
            memory: 250M
            ephemeral-storage: 4Gi
---
apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: symbols
spec:
  replicas: 1
  template:
    spec:
      containers:
      - name: symbols
        env:
        # Enables Rockskip
        - name: USE_ROCKSKIP
          value: "true"
        # Uses Rockskip for all repositories over 1GB
        - name: ROCKSKIP_MIN_REPO_SIZE_MB
          value: "1000"
        resources:
          limits:
            cpu: "6"
            memory: 12G
          requests:
            cpu: 100m
            memory: 250M
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: syntect-server
spec:
  replicas: 1
  template:
    spec:
      containers:
      - name: syntect-server
        resources:
          limits:
            cpu: "4"
            memory: 6G
          requests:
            cpu: 100m
            memory: 250M
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: worker
spec:
  replicas: 1
  template:
    spec:
      containers:
      - name: worker
        resources:
          limits:
            cpu: "4"
            memory: 4G
          requests:
            cpu: 100m
            memory: 250M
---
apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: gitserver
spec:
  replicas: 2
  template:
    spec:
      containers:
      - name: gitserver
        resources:
          limits:
            cpu: "12"
            memory: 20G
          requests:
            cpu: 100m
            memory: 250M
---
apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: indexed-search
spec:
  replicas: 3
  template:
    spec:
      containers:
      - name: zoekt-webserver
        resources:
          limits:
            cpu: "12"
            memory: 16G
          requests:
            cpu: 100m
            memory: 250M
      - name: zoekt-indexserver
        resources:
          limits:
            cpu: "5"
            memory: 10G
          requests:
            cpu: 100m
            memory: 250M
